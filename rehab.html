import React, { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Calendar } from "@/components/ui/calendar";
import { format } from "date-fns";
import { ChromePicker } from "react-color";

const ProjectDashboard = () => {
  const [projectName, setProjectName] = useState("");
  const [projectSaved, setProjectSaved] = useState(false);
  const [description, setDescription] = useState("");
  const [tasks, setTasks] = useState([]);
  const [task, setTask] = useState("");
  const [startDate, setStartDate] = useState(new Date());
  const [endDate, setEndDate] = useState(new Date());
  const [expenses, setExpenses] = useState([]);
  const [expense, setExpense] = useState("");
  const [expenseType, setExpenseType] = useState("purchase");
  const [color, setColor] = useState("#00aaff");

  const saveProject = () => {
    setProjectSaved(true);
  };

  const addTask = () => {
    setTasks([...tasks, { task, startDate, endDate, color }]);
    setTask("");
  };

  const addExpense = () => {
    setExpenses([...expenses, { expense, type: expenseType }]);
    setExpense("");
  };

  const editExpense = (index, newValue) => {
    const updated = [...expenses];
    updated[index].expense = newValue;
    setExpenses(updated);
  };

  const moveTask = (index, days) => {
    const updated = [...tasks];
    updated[index].startDate = new Date(updated[index].startDate.getTime() + days * 86400000);
    updated[index].endDate = new Date(updated[index].endDate.getTime() + days * 86400000);
    setTasks(updated);
  };

  const updateColor = (index, newColor) => {
    const updated = [...tasks];
    updated[index].color = newColor;
    setTasks(updated);
  };

  return (
    <ScrollArea className="p-4 space-y-6">
      <div className="flex items-center justify-between">
        <h1 className="text-3xl font-bold">Project Management Dashboard</h1>
        {projectSaved && (
          <span className="text-sm bg-blue-100 text-blue-700 px-3 py-1 rounded">
            {projectName}
          </span>
        )}
      </div>

      <Card>
        <CardContent className="space-y-2">
          <Input
            placeholder="Project Name"
            value={projectName}
            onChange={(e) => setProjectName(e.target.value)}
          />
          <Textarea
            placeholder="Project Description"
            value={description}
            onChange={(e) => setDescription(e.target.value)}
          />
          <Button onClick={saveProject}>Save Project</Button>
        </CardContent>
      </Card>

      <Card>
        <CardContent className="space-y-2">
          <h2 className="text-xl font-semibold">Tasks</h2>
          <Input
            placeholder="Task Name"
            value={task}
            onChange={(e) => setTask(e.target.value)}
          />
          <div className="flex space-x-4">
            <Calendar selected={startDate} onSelect={setStartDate} />
            <Calendar selected={endDate} onSelect={setEndDate} />
          </div>
          <div>
            <ChromePicker color={color} onChangeComplete={(c) => setColor(c.hex)} />
          </div>
          <Button onClick={addTask}>Add Task</Button>
          <div className="space-y-2 mt-4">
            {tasks.map((t, i) => (
              <div key={i} className="p-2 border rounded" style={{ backgroundColor: t.color }}>
                <p className="font-semibold">{t.task}</p>
                <p>
                  {format(t.startDate, "MMM d")} - {format(t.endDate, "MMM d")}
                </p>
                <div className="flex space-x-2 mt-2">
                  <Button size="sm" onClick={() => moveTask(i, -1)}>◀️</Button>
                  <Button size="sm" onClick={() => moveTask(i, 1)}>▶️</Button>
                  <ChromePicker
                    color={t.color}
                    onChangeComplete={(c) => updateColor(i, c.hex)}
                  />
                </div>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>

      <Card>
        <CardContent className="space-y-2">
          <h2 className="text-xl font-semibold">Expenses</h2>
          <Input
            placeholder="Expense Description"
            value={expense}
            onChange={(e) => setExpense(e.target.value)}
          />
          <select
            value={expenseType}
            onChange={(e) => setExpenseType(e.target.value)}
            className="border px-2 py-1 rounded"
          >
            <option value="purchase">Purchase</option>
            <option value="service">Service</option>
            <option value="other">Other</option>
          </select>
          <Button onClick={addExpense}>Add Expense</Button>
          <div className="space-y-2 mt-4">
            {expenses.map((e, i) => (
              <div key={i} className="border p-2 rounded">
                <Input
                  value={e.expense}
                  onChange={(ev) => editExpense(i, ev.target.value)}
                />
                <p className="text-sm text-gray-500">Type: {e.type}</p>
              </div>
            ))}
          </div>
        </CardContent>
      </Card>
    </ScrollArea>
  );
};

export default ProjectDashboard;
